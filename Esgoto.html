<!DOCTYPE html>
<html lang="pt-BR">
<div class="caixote">

    <head>

        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="./" type="image/x-icon">
        <link rel="shortcut icon" href="img/favicon.jpeg" type="image/x-icon">
        <title>Dimensionamento de Esgoto</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
        <link rel="stylesheet" href="./styles/styles.css">
        <link
            href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@700&family=Barlow:wght@400;600&display=swap"
            rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    </head>

    <body data-bs-theme="light">
        <header class="cabecalho">
            <nav class="navbar bg-body-tertiary navbar-expand-lg">
                <div class="container-fluid cabecalho_conteudo">

                    <a class="navbar-brand" href="index.html"><img src="img/saae-logo.png" class="logo"
                            alt="logo SAAE"></a>
                    <h1 class="titulo">Planilha para Dimensionamento de Redes Coletoras de Esgoto</h1>

                    
                    </div>
                </div>
            </nav>

        </header>

        <main class="wrapper">
            <div class="content">
                <h2>Tabela de Trechos</h2> 
                <label class="custom-file-upload"> 
                    <i class="fas fa-download"></i> Escolher Arquivo 
                    <input type="file" id="inputCSV" accept=".csv" onchange="lerCSV(event)"> 
                </label><br> 
                <button onclick="salvarComoXLSX()"><i class="fas fa-save"></i> </button> 
                <button class="linha" type="button" onclick="addRow()">+</button>
                <button type="button" onclick="removeLastRow()">-</button>
                <button onclick="window.location.href='index.html'"><i class="fas fa-home"></i></button>


                <div style = "overflow-x: auto;">
                <table id="tabelaTrechos">
                    <thead>
                        <tr>
                            <th>Trecho</th>
                            <th>Extensão (m)</th>
                            <th>Cota de Montante (m)</th>
                            <th>Cota de Jusante (m)</th>
                            <th>Declividade</th>
                            <th>Coluna 6</th> 
                            <th>Coluna 7</th> 
                            <th>Coluna 8</th> 
                            <th>Coluna 9</th> 
                            <th>Coluna 10</th> 
                            <th>Coluna 11</th> 
                            <th>Coluna 12</th> 
                            <th>Coluna 13</th> 
                            <th>Coluna 14</th> 
                            <th>Coluna 15</th> 
                            <th>Coluna 16</th> 
                            <th>Coluna 17</th> 
                            <th>Coluna 18</th> 
                            <th>Coluna 19</th> 
                            <th>Coluna 20</th> 
                            <th>Coluna 21</th> 
                            <th>Coluna 22</th> 
                            <th>Coluna 23</th> 
                            
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" id="trecho1"></td>
                            <td><input type="number" id="extensao1" oninput="calcularDeclividade(1)"></td>
                            <td><input type="number" id="cotaMontante1" oninput="calcularDeclividade(1)"></td>
                            <td><input type="number" id="cotaJusante1" oninput="calcularDeclividade(1)"></td>
                            <td><input type="text" id="declividade1" disabled></td>
                            <td><input type="number" id="coluna6-1"></td> 
                            <td><input type="number" id="coluna7-1"></td> 
                            <td><input type="number" id="coluna8-1"></td> 
                            <td><input type="number" id="coluna9-1"></td> 
                            <td><input type="number" id="coluna10-1"></td> 
                            <td><input type="number" id="coluna11-1"></td> 
                            <td><input type="number" id="coluna12-1"></td> 
                            <td><input type="number" id="coluna13-1"></td> 
                            <td><input type="number" id="coluna14-1"></td> 
                            <td><input type="number" id="coluna15-1"></td> 
                            <td><input type="number" id="coluna16-1"></td> 
                            <td><input type="number" id="coluna17-1"></td> 
                            <td><input type="number" id="coluna18-1"></td> 
                            <td><input type="number" id="coluna19-1"></td> 
                            <td><input type="number" id="coluna20-1"></td> 
                            <td><input type="number" id="coluna21-1"></td> 
                            <td><input type="number" id="coluna22-1"></td> 
                            <td><input type="number" id="coluna23-1"></td>
                        </tr>
                        <tr>
                            <td><input type="text" id="trecho2"></td>
                            <td><input type="number" id="extensao2" oninput="calcularDeclividade(2)"></td>
                            <td><input type="number" id="cotaMontante2" oninput="calcularDeclividade(2)"></td>
                            <td><input type="number" id="cotaJusante2" oninput="calcularDeclividade(2)"></td>
                            <td><input type="text" id="declividade2" disabled></td>
                            <td><input type="number" id="coluna6-1"></td> 
                            <td><input type="number" id="coluna7-1"></td> 
                            <td><input type="number" id="coluna8-1"></td> 
                            <td><input type="number" id="coluna9-1"></td> 
                            <td><input type="number" id="coluna10-1"></td> 
                            <td><input type="number" id="coluna11-1"></td> 
                            <td><input type="number" id="coluna12-1"></td> 
                            <td><input type="number" id="coluna13-1"></td> 
                            <td><input type="number" id="coluna14-1"></td> 
                            <td><input type="number" id="coluna15-1"></td> 
                            <td><input type="number" id="coluna16-1"></td> 
                            <td><input type="number" id="coluna17-1"></td> 
                            <td><input type="number" id="coluna18-1"></td> 
                            <td><input type="number" id="coluna19-1"></td> 
                            <td><input type="number" id="coluna20-1"></td> 
                            <td><input type="number" id="coluna21-1"></td> 
                            <td><input type="number" id="coluna22-1"></td> 
                            <td><input type="number" id="coluna23-1"></td>
                        </tr>
                        <tr>
                            <td><input type="text" id="trecho3"></td>
                            <td><input type="number" id="extensao3" oninput="calcularDeclividade(3)"></td>
                            <td><input type="number" id="cotaMontante3" oninput="calcularDeclividade(3)"></td>
                            <td><input type="number" id="cotaJusante3" oninput="calcularDeclividade(3)"></td>
                            <td><input type="text" id="declividade3" disabled></td>
                            <td><input type="number" id="coluna6-1"></td> 
                            <td><input type="number" id="coluna7-1"></td> 
                            <td><input type="number" id="coluna8-1"></td> 
                            <td><input type="number" id="coluna9-1"></td> 
                            <td><input type="number" id="coluna10-1"></td> 
                            <td><input type="number" id="coluna11-1"></td> 
                            <td><input type="number" id="coluna12-1"></td> 
                            <td><input type="number" id="coluna13-1"></td> 
                            <td><input type="number" id="coluna14-1"></td> 
                            <td><input type="number" id="coluna15-1"></td> 
                            <td><input type="number" id="coluna16-1"></td> 
                            <td><input type="number" id="coluna17-1"></td> 
                            <td><input type="number" id="coluna18-1"></td> 
                            <td><input type="number" id="coluna19-1"></td> 
                            <td><input type="number" id="coluna20-1"></td> 
                            <td><input type="number" id="coluna21-1"></td> 
                            <td><input type="number" id="coluna22-1"></td> 
                            <td><input type="number" id="coluna23-1"></td>
                        </tr>
                    </tbody>
                </table>

            </div>
                
            </div>
        </main>
        <footer class="text-center fixed-bottom footer">
            <section class="container p-4 pb-0 mb-1">
                <a class="btn" href="https://github.com/PostigoGustavo"><i class="bi bi-github"></i></a>
                <a class="btn" href="https://www.instagram.com/postigo_gustavo/"><i class="bi bi-instagram"></i></a>
                <a class="btn" href="https://www.linkedin.com/in/gustavo-postigo-santos-0642a5216/"><i
                        class="bi bi-linkedin"></i></i></a>
            </section>
            <div class="mb-1">
                2024 <i class="bi bi-c-circle"></i> Desenvolvido por Gustavo Postigo Santos
            </div>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
        <script>

function addRow() { 
    var table = document.getElementById("tabelaTrechos").getElementsByTagName('tbody')[0]; var rowCount = table.rows.length + 1; var row = table.insertRow(); var cell1 = row.insertCell(0); var element1 = document.createElement("input"); element1.type = "text"; element1.id = "trecho" + rowCount; cell1.appendChild(element1); var cell2 = row.insertCell(1); var element2 = document.createElement("input"); element2.type = "number"; element2.id = "extensao" + rowCount; element2.setAttribute("oninput", "calcularDeclividade(" + rowCount + ")"); cell2.appendChild(element2); var cell3 = row.insertCell(2); var element3 = document.createElement("input"); element3.type = "number"; element3.id = "cotaMontante" + rowCount; element3.setAttribute("oninput", "calcularDeclividade(" + rowCount + ")"); cell3.appendChild(element3); var cell4 = row.insertCell(3); var element4 = document.createElement("input"); element4.type = "number"; element4.id = "cotaJusante" + rowCount; element4.setAttribute("oninput", "calcularDeclividade(" + rowCount + ")"); cell4.appendChild(element4); var cell5 = row.insertCell(4); var element5 = document.createElement("input"); element5.type = "number"; element5.id = "declividade" + rowCount; element5.disabled = true; cell5.appendChild(element5); // Adiciona mais colunas de 6 a 23 
    for (let i = 6; i <= 23; i++) { var cell = row.insertCell(i - 1); // Ajuste no índice da célula 
var element = document.createElement("input"); element.type = "number"; element.id = "coluna" + i + "-" + rowCount; cell.appendChild(element); 
} 
}


            function calcularDeclividade(linha) {
                var extensao = parseFloat(document.getElementById('extensao' + linha).value);
                var cotaMontante = parseFloat(document.getElementById('cotaMontante' + linha).value);
                var cotaJusante = parseFloat(document.getElementById('cotaJusante' + linha).value);

                if (!isNaN(extensao) && !isNaN(cotaMontante) && !isNaN(cotaJusante) && extensao !== 0) {
                    var declividade = (cotaMontante - cotaJusante) / extensao;
                    document.getElementById('declividade' + linha).value = declividade.toFixed(4);
                } else {
                    document.getElementById('declividade' + linha).value = '';
                }
            }

            function lerCSV(event) {
                var input = event.target;
                var reader = new FileReader();
                reader.onload = function () {
                    var data = reader.result;
                    console.log('Dados lidos do arquivo:', data); // Log para verificar os dados lidos
                    var linhas = data.split('\n');
                    console.log('Linhas do arquivo:', linhas); // Log para verificar as linhas
                    var tabela = document.getElementById('tabelaTrechos').getElementsByTagName('tbody')[0];
                    tabela.innerHTML = ''; // Limpa a tabela antes de adicionar novos dados
                    for (var i = 1; i < linhas.length; i++) { // Começa de 1 para pular o cabeçalho
                        var cols = linhas[i].split(',');
                        console.log('Colunas da linha', i, ':', cols); // Log para verificar as colunas
                        if (cols.length >= 4) { // Verifica se há pelo menos 4 colunas
                            var novaLinha = tabela.insertRow();
                            for (var j = 0; j < 4; j++) {
                                var novaCelula = novaLinha.insertCell();
                                var input = document.createElement('input');
                                input.type = (j === 0) ? 'text' : 'number';
                                input.value = cols[j].trim(); // Remover espaços em branco
                                input.id = (j === 0 ? 'trecho' : j === 1 ? 'extensao' : j === 2 ? 'cotaMontante' : 'cotaJusante') + i;
                                if (j === 3) {
                                    console.log('Cota de Jusante da linha', i, ':', cols[j]); // Log para verificar a Cota de Jusante
                                }
                                if (j !== 0) {
                                    input.oninput = (function (i) { return function () { calcularDeclividade(i); }; })(i);
                                }
                                novaCelula.appendChild(input);
                            }
                            var novaCelulaDeclividade = novaLinha.insertCell();
                            var inputDeclividade = document.createElement('input');
                            inputDeclividade.type = 'text';
                            inputDeclividade.disabled = true;
                            inputDeclividade.id = 'declividade' + i;
                            novaCelulaDeclividade.appendChild(inputDeclividade);
                            calcularDeclividade(i);
                        } else {
                            console.log('Linha', i, 'não possui 4 colunas:', cols); // Log para verificar se a linha não possui 4 colunas
                        }
                    }
                };
                reader.readAsText(input.files[0]);
            }





            function salvarComoXLSX() {
                var tabela = document.getElementById('tabelaTrechos').getElementsByTagName('tbody')[0];
                var dados = [];
                var linhas = tabela.getElementsByTagName('tr');

                dados.push(["Trecho", "Extensão", "Cota de Montante", "Cota de Jusante", "Declividade"]);
                for (var i = 0; i < linhas.length; i++) {
                    var colunas = linhas[i].getElementsByTagName('input');
                    var linha = [];
                    for (var j = 0; j < colunas.length; j++) {
                        linha.push(colunas[j].value);
                    }
                    dados.push(linha);
                }

                var ws = XLSX.utils.aoa_to_sheet(dados);
                var wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Trechos");
                XLSX.writeFile(wb, "dados.xlsx");
            }

            function removeLastRow() {
                var table = document.getElementById("tabelaTrechos");
                var rowCount = table.rows.length;

                if (rowCount > 2) { // Mantém ao menos o cabeçalho e uma linha de dados
                    table.deleteRow(rowCount - 1);
                }
            }
        </script>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
            crossorigin="anonymous"></script>
    </body>
</div>

</html>